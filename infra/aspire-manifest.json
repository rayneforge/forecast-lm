{
  "$schema": "https://json.schemastore.org/aspire-8.0.json",
  "resources": {
    "storage": {
      "type": "azure.bicep.v0",
      "path": "storage.module.bicep"
    },
    "blobs": {
      "type": "value.v0",
      "connectionString": "{storage.outputs.blobEndpoint}"
    },
    "client-api": {
      "type": "project.v0",
      "path": "../src/Rayneforge.Forecast.API.Client/Rayneforge.Forecast.API.Client.csproj",
      "env": {
        "OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EXCEPTION_LOG_ATTRIBUTES": "true",
        "OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EVENT_LOG_ATTRIBUTES": "true",
        "OTEL_DOTNET_EXPERIMENTAL_OTLP_RETRY": "in_memory",
        "ASPNETCORE_FORWARDEDHEADERS_ENABLED": "true",
        "HTTP_PORTS": "{client-api.bindings.http.targetPort}",
        "ConnectionStrings__blobs": "{blobs.connectionString}",
        "BLOBS_URI": "{storage.outputs.blobEndpoint}",
        "Providers__Database": "cosmos",
        "Providers__News": "newsapi",
        "Providers__Embedding": "azureopenai",
        "Providers__LLM": "azureopenai",
        "Mcp__Transport": "sse",
        "AzureAd__Instance": "",
        "AzureAd__TenantId": "",
        "AzureAd__ClientId": "",
        "ConnectionStrings__NewsDb": "{NewsDb.connectionString}",
        "NEWSDB_URI": "{cosmos.outputs.connectionString}",
        "NEWSDB_DATABASENAME": "NewsDb",
        "ConnectionStrings__UserDb": "{UserDb.connectionString}",
        "USERDB_URI": "{cosmos.outputs.connectionString}",
        "USERDB_DATABASENAME": "UserDb",
        "ConnectionStrings__embeddings": "{embeddings.connectionString}",
        "EMBEDDINGS_URI": "{aoai.outputs.endpoint}",
        "EMBEDDINGS_MODELNAME": "embeddings",
        "ConnectionStrings__chat-basic": "{chat-basic.connectionString}",
        "CHAT_BASIC_URI": "{aoai.outputs.endpoint}",
        "CHAT_BASIC_MODELNAME": "chat-basic",
        "ConnectionStrings__chat-lite": "{chat-lite.connectionString}",
        "CHAT_LITE_URI": "{aoai.outputs.endpoint}",
        "CHAT_LITE_MODELNAME": "chat-lite",
        "LLM__AzureOpenAI__Endpoint": "https://YOUR_RESOURCE.openai.azure.com/",
        "LLM__AzureOpenAI__BasicDeployment": "chat-basic",
        "LLM__AzureOpenAI__LiteDeployment": "chat-lite",
        "LLM__AzureOpenAI__UseManagedIdentity": "true"
      },
      "bindings": {
        "http": {
          "scheme": "http",
          "protocol": "tcp",
          "transport": "http"
        },
        "https": {
          "scheme": "https",
          "protocol": "tcp",
          "transport": "http"
        }
      }
    },
    "management-api": {
      "type": "project.v0",
      "path": "../src/Rayneforge.Forecast.API.Management/Rayneforge.Forecast.API.Management.csproj",
      "env": {
        "OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EXCEPTION_LOG_ATTRIBUTES": "true",
        "OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EVENT_LOG_ATTRIBUTES": "true",
        "OTEL_DOTNET_EXPERIMENTAL_OTLP_RETRY": "in_memory",
        "ASPNETCORE_FORWARDEDHEADERS_ENABLED": "true",
        "HTTP_PORTS": "{management-api.bindings.http.targetPort}",
        "Providers__Database": "cosmos",
        "AzureAd__Instance": "",
        "AzureAd__TenantId": "",
        "AzureAd__ClientId": "",
        "ConnectionStrings__NewsDb": "{NewsDb.connectionString}",
        "NEWSDB_URI": "{cosmos.outputs.connectionString}",
        "NEWSDB_DATABASENAME": "NewsDb",
        "ConnectionStrings__UserDb": "{UserDb.connectionString}",
        "USERDB_URI": "{cosmos.outputs.connectionString}",
        "USERDB_DATABASENAME": "UserDb"
      },
      "bindings": {
        "http": {
          "scheme": "http",
          "protocol": "tcp",
          "transport": "http"
        },
        "https": {
          "scheme": "https",
          "protocol": "tcp",
          "transport": "http"
        }
      }
    },
    "web": {
      "type": "container.v1",
      "build": {
        "context": "../src/Rayneforge.Forecast.UI",
        "dockerfile": "../src/Rayneforge.Forecast.UI/Dockerfile"
      },
      "env": {
        "CLIENT_API_HTTP": "{client-api.bindings.http.url}",
        "services__client-api__http__0": "{client-api.bindings.http.url}",
        "CLIENT_API_HTTPS": "{client-api.bindings.https.url}",
        "services__client-api__https__0": "{client-api.bindings.https.url}"
      },
      "bindings": {
        "http": {
          "scheme": "http",
          "protocol": "tcp",
          "transport": "http",
          "targetPort": 80,
          "external": true
        }
      }
    },
    "worker": {
      "type": "project.v0",
      "path": "../src/Rayneforge.Forecast.Worker/Rayneforge.Forecast.Worker.csproj",
      "env": {
        "OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EXCEPTION_LOG_ATTRIBUTES": "true",
        "OTEL_DOTNET_EXPERIMENTAL_OTLP_EMIT_EVENT_LOG_ATTRIBUTES": "true",
        "OTEL_DOTNET_EXPERIMENTAL_OTLP_RETRY": "in_memory",
        "ConnectionStrings__blobs": "{blobs.connectionString}",
        "BLOBS_URI": "{storage.outputs.blobEndpoint}",
        "AzureWebJobsStorage": "{storage.outputs.blobEndpoint}",
        "Providers__Database": "cosmos",
        "Providers__News": "newsapi",
        "NewsApi__ApiKey": "",
        "Providers__Embedding": "azureopenai",
        "Providers__LLM": "azureopenai",
        "ConnectionStrings__NewsDb": "{NewsDb.connectionString}",
        "NEWSDB_URI": "{cosmos.outputs.connectionString}",
        "NEWSDB_DATABASENAME": "NewsDb",
        "ConnectionStrings__embeddings": "{embeddings.connectionString}",
        "EMBEDDINGS_URI": "{aoai.outputs.endpoint}",
        "EMBEDDINGS_MODELNAME": "embeddings",
        "ConnectionStrings__chat-basic": "{chat-basic.connectionString}",
        "CHAT_BASIC_URI": "{aoai.outputs.endpoint}",
        "CHAT_BASIC_MODELNAME": "chat-basic",
        "ConnectionStrings__chat-lite": "{chat-lite.connectionString}",
        "CHAT_LITE_URI": "{aoai.outputs.endpoint}",
        "CHAT_LITE_MODELNAME": "chat-lite",
        "LLM__AzureOpenAI__Endpoint": "https://YOUR_RESOURCE.openai.azure.com/",
        "LLM__AzureOpenAI__BasicDeployment": "chat-basic",
        "LLM__AzureOpenAI__LiteDeployment": "chat-lite",
        "LLM__AzureOpenAI__UseManagedIdentity": "true",
        "ConnectionStrings__messaging": "{messaging.connectionString}",
        "MESSAGING_HOST": "{messaging.outputs.serviceBusHostName}",
        "MESSAGING_URI": "{messaging.outputs.serviceBusEndpoint}",
        "ConnectionStrings__article-ingest": "{article-ingest.connectionString}",
        "ARTICLE_INGEST_HOST": "{messaging.outputs.serviceBusHostName}",
        "ARTICLE_INGEST_URI": "{messaging.outputs.serviceBusEndpoint}",
        "ARTICLE_INGEST_QUEUENAME": "article-ingest",
        "ServiceBusConnection": "{messaging.outputs.serviceBusEndpoint}",
        "Providers__MessageBus": "azureservicebus"
      }
    },
    "cosmos": {
      "type": "azure.bicep.v0",
      "connectionString": "{cosmos.outputs.connectionString}",
      "path": "cosmos.module.bicep"
    },
    "NewsDb": {
      "type": "value.v0",
      "connectionString": "AccountEndpoint={cosmos.outputs.connectionString};Database=NewsDb"
    },
    "news": {
      "type": "value.v0",
      "connectionString": "AccountEndpoint={cosmos.outputs.connectionString};Database=NewsDb;Container=news"
    },
    "entities": {
      "type": "value.v0",
      "connectionString": "AccountEndpoint={cosmos.outputs.connectionString};Database=NewsDb;Container=entities"
    },
    "claims": {
      "type": "value.v0",
      "connectionString": "AccountEndpoint={cosmos.outputs.connectionString};Database=NewsDb;Container=claims"
    },
    "narratives": {
      "type": "value.v0",
      "connectionString": "AccountEndpoint={cosmos.outputs.connectionString};Database=NewsDb;Container=narratives"
    },
    "claim-entities": {
      "type": "value.v0",
      "connectionString": "AccountEndpoint={cosmos.outputs.connectionString};Database=NewsDb;Container=claim-entities"
    },
    "narrative-claims": {
      "type": "value.v0",
      "connectionString": "AccountEndpoint={cosmos.outputs.connectionString};Database=NewsDb;Container=narrative-claims"
    },
    "narrative-entities": {
      "type": "value.v0",
      "connectionString": "AccountEndpoint={cosmos.outputs.connectionString};Database=NewsDb;Container=narrative-entities"
    },
    "UserDb": {
      "type": "value.v0",
      "connectionString": "AccountEndpoint={cosmos.outputs.connectionString};Database=UserDb"
    },
    "threads": {
      "type": "value.v0",
      "connectionString": "AccountEndpoint={cosmos.outputs.connectionString};Database=UserDb;Container=threads"
    },
    "messages": {
      "type": "value.v0",
      "connectionString": "AccountEndpoint={cosmos.outputs.connectionString};Database=UserDb;Container=messages"
    },
    "workspaces": {
      "type": "value.v0",
      "connectionString": "AccountEndpoint={cosmos.outputs.connectionString};Database=UserDb;Container=workspaces"
    },
    "workspace-links": {
      "type": "value.v0",
      "connectionString": "AccountEndpoint={cosmos.outputs.connectionString};Database=UserDb;Container=workspace-links"
    },
    "aoai": {
      "type": "azure.bicep.v0",
      "connectionString": "{aoai.outputs.connectionString}",
      "path": "aoai.module.bicep"
    },
    "embeddings": {
      "type": "value.v0",
      "connectionString": "{aoai.outputs.connectionString};Deployment=embeddings"
    },
    "chat-basic": {
      "type": "value.v0",
      "connectionString": "{aoai.outputs.connectionString};Deployment=chat-basic"
    },
    "chat-lite": {
      "type": "value.v0",
      "connectionString": "{aoai.outputs.connectionString};Deployment=chat-lite"
    },
    "messaging": {
      "type": "azure.bicep.v0",
      "connectionString": "{messaging.outputs.serviceBusEndpoint}",
      "path": "messaging.module.bicep"
    },
    "article-ingest": {
      "type": "value.v0",
      "connectionString": "Endpoint={messaging.outputs.serviceBusEndpoint};EntityPath=article-ingest"
    },
    "storage-roles": {
      "type": "azure.bicep.v0",
      "path": "storage-roles.module.bicep",
      "params": {
        "storage_outputs_name": "{storage.outputs.name}",
        "principalType": "",
        "principalId": ""
      }
    },
    "cosmos-roles": {
      "type": "azure.bicep.v0",
      "path": "cosmos-roles.module.bicep",
      "params": {
        "cosmos_outputs_name": "{cosmos.outputs.name}",
        "principalId": ""
      }
    },
    "aoai-roles": {
      "type": "azure.bicep.v0",
      "path": "aoai-roles.module.bicep",
      "params": {
        "aoai_outputs_name": "{aoai.outputs.name}",
        "principalType": "",
        "principalId": ""
      }
    },
    "messaging-roles": {
      "type": "azure.bicep.v0",
      "path": "messaging-roles.module.bicep",
      "params": {
        "messaging_outputs_name": "{messaging.outputs.name}",
        "principalType": "",
        "principalId": ""
      }
    }
  }
}